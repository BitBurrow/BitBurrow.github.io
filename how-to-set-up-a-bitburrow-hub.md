---
title: How to set up your own BitBurrow hub
---

## NOTE: THIS SOFTWARE DOES NOT EXIST YET

Everything below is proposed draft documentation. The software to do what is described is being developed and is not at all usable yet.

## Introduction

BitBurrow is a set of tools to help you set up and use a VPN server anywhere--at your parents' house, an office, or a friend's apartment.

BitBurrow has two major components--an app and a hub. ...

## What you will need

1. Some background in Linux system administration and working on the command line.
1. A Linux server with a fixed, public IPv4 address, e.g. from [DigitalOcean](https://www.digitalocean.com/), [Linode](https://www.linode.com/), or other VPS provider. BitBurrow can share the server with other services so long as TCP ports 53 and 8443, and UDP port 53 are available.
1. A domain or subdomain name with the ability to host your own DNS (i.e. add an NS record for the subdomain).
1. Time to manage a public server long-term.

## Why would you want to do this

1. 

## Steps

### Acquire a domain name

Purchase your new domain name from a [domain name registrar](https://en.wikipedia.org/wiki/Domain_name_registrar) such as [Hover](https://www.hover.com/) or [Google Domains](https://domains.google/). Alternatively, create a new subdomain for an existing domain such as your company or organization. For example, if your organization owns `example.org`, you could set up `rxb.example.org` to use for BitBurrow, where `rxb` is a subdomain you choose.

When choosing a domain name or subdomain, it is recommended that it *not* contain `vpn`, `proxy`, `bitburrow`, `gateway`, or similar words. Public WiFi networks that restrict VPN usage may block domain names that include these. Also, choosing a name that is easy to type will make it easier for admins setting up VPN servers.

### Set up the Linux server

These instructions are written for Ubuntu. If you are setting up a new server, use the most recent Ubuntu LTS server image.

1. Sign in to the Linux server, preferably as a normal user with `sudo` privileges.
1. Configure automatic security updates ([more information](https://help.ubuntu.com/community/AutomaticSecurityUpdates)):
    ```
    sudo apt update
    sudo apt install unattended-upgrades
    sudo dpkg-reconfigure --priority=low unattended-upgrades  # choose Yes when prompted
    ```

### Create a container

This section is recommended but not required. A container helps with security by isolating BitBurrow hub from other applications running on the same server, provides a firewall from the internet, and allows the hub to run processes as root without actually being root. Additionally, to simplify the installation process below, you can run Ubuntu inside the container even if the host uses another Linux flavor.

1. Install LXD:
    ```
    sudo snap install lxd
    ```
1. Initialize LXD--choose **one** of these lines; the first one will prompt you with options:
    ```
    lxd init
    lxd init --auto --storage-backend=btrfs --storage-create-loop=10
    ```
1. Create a new container and sign in:
    ```
    VMNAME=bitburrow  # 'bitburrow' is the name of the new container (change it if you like)
    lxc launch ubuntu: $VMNAME
    lxc exec $VMNAME -- sudo -u ubuntu -i  # now you are in the container
    ```

### Install BitBurrow hub

In the third step below, replace `rxb.example.org` with your BitBurrow hub domain name and replace `1.2.3.4` with the public IP address of your BitBurrow hub host machine.

1. Enable `ssh localhost` (run inside container):
    ```
    mkdir -p ~/.ssh/
    ssh-keygen -q -f ~/.ssh/id_ed25519 -N '' -t ed25519
    cat ~/.ssh/id_ed25519.pub >>~/.ssh/authorized_keys
    echo "* $(cat /etc/ssh/ssh_host_ecdsa_key.pub)" >>~/.ssh/known_hosts
    chmod go-w ~ ~/.ssh; chmod ugo-x,go-w ~/.ssh/authorized_keys
    ```
1. Install dependencies (run inside container):
    ```
    sudo apt update
    sudo apt install -y wget ansible
    mkdir -p ~/hub && cd $_
    wget https://raw.githubusercontent.com/BitBurrow/BitBurrow/main/src/hub_installer/install.yaml
    ```
1. Set your domain name and IP (run inside container):
    ```
    sudo -u bitburrow /home/bitburrow/.local/bin/bbhub --create-admin-account
    DOMAIN=rxb.example.org
    IP=1.2.3.4
    ```
1. Run Ansible--this will fail if you are using a container but that's okay at this point (run inside container):
    ```
    ansible-playbook -i localhost, install.yaml --extra-vars "domain=$DOMAIN ip=$IP"
    ```

### Forward ports to the container

1. Download and run the script generated by `ansible-playbook`, above (run on host):
    ```
    VMNAME=bitburrow  # use the same name you used for this above
    lxc file pull $VMNAME/home/bitburrow/set_port_forwarding.sh /tmp/set_port_forwarding.sh
    /tmp/set_port_forwarding.sh
    ```
1. The above should display several lines beginning `Device`

### Make BitBurrow hub the authoritative name server

1. Configure the nameserver for example.org (usually done through the website of your domain name registrar), add an NS record for rxb.example.org which points to rxb.example.org. (This tells the internet that rxb.example.org is the authoritative nameserver for *.rxb.example.org.) Then, add an A record for rxb.example.org which points to rxb.example.org (this is called a "glue record"; [more info](https://en.wikipedia.org/wiki/Domain_Name_System#Circular_dependencies_and_glue_records)). Here is a partial zone file for example.org which represents these two records:
	```
	rxb.example.org. 86400 IN NS rxb.example.org.
	rxb.example.org. 3600 IN A 1.2.3.4
	```

### Finish installing BitBurrow hub

1. Run Ansible again (run inside container):
    ```
    cd ~/hub
    ansible-playbook -i localhost, install.yaml
    ```

### Configure ssh directly to container (optional)

In the steps below, replace `rxb.example.org` with your BitBurrow hub domain and `18962` with a port number of your choosing.

This assumes `authorized_keys` on the host is already configured for public-key ssh authentication.

1. Set up ssh to container (run on host):
    ```
    VMNAME=bitburrow
    lxc exec $VMNAME -- apt install -y ssh
    cat ~/.ssh/authorized_keys |lxc exec $VMNAME -- sudo -u bitburrow bash -c 'cd; mkdir -p .ssh; cat - >> ~/.ssh/authorized_keys; chmod go-w . .ssh; chmod ugo-x,go-w .ssh/authorized_keys'
    lxc config device add $VMNAME ssh proxy listen=tcp:0.0.0.0:18962 connect=tcp:127.0.0.1:22
    ```
1. On your personal computer, edit `~/.ssh/config` and add:
    ```
    Host bitburrow
        HostName rxb.example.org
        Port 18962
        User bitburrow
    ```

### Create a BitBurrow hub administrator account and coupon code

1. Add the admin account (run inside container):
    ```
    sudo -u bitburrow /home/bitburrow/.local/bin/bbhub --create-admin-account
    ```
1. Write down this login key in a safe place. It is effectively the master username and password for this BitBurrow hub.
1. Create a coupon code (run inside container):
    ```
    sudo -u bitburrow /home/bitburrow/.local/bin/bbhub --create-coupon-code
    ```
1. Write down this coupon. It is what you will distribute to others to set up their own VPN server.

